{"version":3,"sources":["@wordpress/components/src/slot-fill/bubbles-virtually/slot-fill-provider.js"],"names":["ref","valRef","proxyMap","useState","isShallowEqual","SlotFillContext","createSlotRegistry","slots","fills","registerSlot","name","fillProps","slot","get","set","unregisterSlot","delete","updateSlot","slotFills","map","fill","current","rerender","registerFill","unregisterFill","fillsForName","filter","fillRef","SlotFillProvider","children","registry"],"mappings":"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","sourcesContent":["// @ts-nocheck\n/**\n * External dependencies\n */\nimport { ref as valRef } from 'valtio';\nimport { proxyMap } from 'valtio/utils';\n\n/**\n * WordPress dependencies\n */\nimport { useState } from '@wordpress/element';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport SlotFillContext from './slot-fill-context';\n\nfunction createSlotRegistry() {\n\tconst slots = proxyMap();\n\tconst fills = proxyMap();\n\n\tfunction registerSlot( name, ref, fillProps ) {\n\t\tconst slot = slots.get( name ) || {};\n\t\tslots.set(\n\t\t\tname,\n\t\t\tvalRef( {\n\t\t\t\t...slot,\n\t\t\t\tref: ref || slot.ref,\n\t\t\t\tfillProps: fillProps || slot.fillProps || {},\n\t\t\t} )\n\t\t);\n\t}\n\n\tfunction unregisterSlot( name, ref ) {\n\t\t// Make sure we're not unregistering a slot registered by another element\n\t\t// See https://github.com/WordPress/gutenberg/pull/19242#issuecomment-590295412\n\t\tif ( slots.get( name )?.ref === ref ) {\n\t\t\tslots.delete( name );\n\t\t}\n\t}\n\n\tfunction updateSlot( name, fillProps ) {\n\t\tconst slot = slots.get( name );\n\t\tif ( ! slot ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isShallowEqual( slot.fillProps, fillProps ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tslot.fillProps = fillProps;\n\t\tconst slotFills = fills.get( name );\n\t\tif ( slotFills ) {\n\t\t\t// Force update fills.\n\t\t\tslotFills.map( ( fill ) => fill.current.rerender() );\n\t\t}\n\t}\n\n\tfunction registerFill( name, ref ) {\n\t\tfills.set( name, valRef( [ ...( fills.get( name ) || [] ), ref ] ) );\n\t}\n\n\tfunction unregisterFill( name, ref ) {\n\t\tconst fillsForName = fills.get( name );\n\t\tif ( ! fillsForName ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfills.set(\n\t\t\tname,\n\t\t\tvalRef( fillsForName.filter( ( fillRef ) => fillRef !== ref ) )\n\t\t);\n\t}\n\n\treturn {\n\t\tslots,\n\t\tfills,\n\t\tregisterSlot,\n\t\tupdateSlot,\n\t\tunregisterSlot,\n\t\tregisterFill,\n\t\tunregisterFill,\n\t};\n}\n\nexport default function SlotFillProvider( { children } ) {\n\tconst [ registry ] = useState( createSlotRegistry );\n\treturn (\n\t\t<SlotFillContext.Provider value={ registry }>\n\t\t\t{ children }\n\t\t</SlotFillContext.Provider>\n\t);\n}\n"]}